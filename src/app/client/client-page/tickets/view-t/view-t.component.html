<div class="container">
  <h2>Mes Tickets</h2>

  <div *ngIf="tickets.length === 0" class="no-tickets">
    Aucun ticket trouvÃ©.
  </div>
  <div class="delete-button" *ngIf="tickets.length > 0">
    <button (click)="deleteAllTickets()">ğŸ—‘ï¸ Supprimer tous les tickets</button>
  </div>


  <div class="ticket-grid">
    <div class="ticket-card" *ngFor="let ticket of tickets">
      <div class="ticket-header">
        <div
          class="status-badge"
          [ngClass]="{
            'CrÃ©Ã©': ticket.status === 'CrÃ©Ã©',
            'Vu': ticket.status === 'Vu',
            'Traitement': ticket.status === 'Traitement',
            'RÃ©pondu': ticket.status === 'RÃ©pondu'
          }"
        >
          {{ ticket.status }}
        </div>
      </div>

      <div class="ticket-body">
        <p><strong>Appareil:</strong> {{ ticket.device_name }} ({{ ticket.device_id }})</p>
        <p><strong>Description:</strong> {{ ticket.breve_description }}</p>
        <p><strong>Infos complÃ©mentaires:</strong> {{ ticket.info_complementaires }}</p>
      </div>

      <div class="ticket-footer">
        <p><strong>CrÃ©Ã© le:</strong> {{ ticket.created_at ? (ticket.created_at | date:'medium') : 'Date inconnue' }}</p>

        <div 
          class="ticket-timeline"
          [ngClass]="{
            'status-crÃ©Ã©': ticket.status === 'CrÃ©Ã©',
            'status-vu': ticket.status === 'Vu',
            'status-traitement': ticket.status === 'Traitement',
            'status-rÃ©pondu': ticket.status === 'RÃ©pondu'
          }"
        >
          <div class="timeline-step" [class.completed]="
            ticket.status === 'CrÃ©Ã©' || ticket.status === 'Vu' || ticket.status === 'Traitement' || ticket.status === 'RÃ©pondu'
          ">
            <div class="icon">ğŸ</div>
            <div class="label">CrÃ©Ã©</div>
          </div>

          <div class="timeline-step" [class.completed]="
            ticket.status === 'Vu' || ticket.status === 'Traitement' || ticket.status === 'RÃ©pondu'
          ">
            <div class="icon">ğŸ‘ï¸</div>
            <div class="label">Vu</div>
          </div>

          <div class="timeline-step" [class.completed]="
            ticket.status === 'Traitement' || ticket.status === 'RÃ©pondu'
          ">
            <div class="icon">ğŸ”§</div>
            <div class="label">Traitement</div>
          </div>

          <div class="timeline-step" [class.completed]="ticket.status === 'RÃ©pondu'">
            <div class="icon">âœ…</div>
            <div class="label">RÃ©pondu</div>
          </div>
        </div>

        <div *ngIf="isConsultant" style="margin-top: 10px;">
          <label for="status-select-{{ticket._id}}">Changer le statut :</label>
          <select id="status-select-{{ticket._id}}" [(ngModel)]="ticket.status">
            <option value="CrÃ©Ã©">CrÃ©Ã©</option>
            <option value="Vu">Vu</option>
            <option value="Traitement">Traitement</option>
            <option value="RÃ©pondu">RÃ©pondu</option>
          </select>
          <button (click)="updateStatus(ticket)">Mettre Ã  jour</button>
        </div>
      </div>
    </div>
  </div>
  
</div>